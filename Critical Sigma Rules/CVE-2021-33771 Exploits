rule CVE_2021_33771_Exploits {
  meta:
    author = "Sittikorn S, frack113"
    description = "Detects patterns as noticed in exploitation of Windows CVE-2021-31979 CVE-2021-33771 vulnerability and DevilsTongue malware by threat group Sourgum"
    reference = "https://www.microsoft.com/security/blog/2021/07/15/protecting-customers-from-a-private-sector-offensive-actor-using-0-day-exploits-and-devilstongue-malware/, https://citizenlab.ca/2021/07/hooking-candiru-another-mercenary-spyware-vendor-comes-into-focus/"
    sigma_id = "32b5db62-cb5f-4266-9639-0fa48376ac00"
    severity = "CRITICAL"
    priority = "CRITICAL"
    platform = "Windows"
    mitre_attack_tactic = "Execution"
    mitre_attack_technique = "Exploitation for Client Execution"
    version = "1.00" 

  events:
    $event.metadata.event_type = "REGISTRY_MODIFICATION"
    $event.target.registry.registry_key = /CLSID\\\{CF4CC405-E2C5-4DDD-B3CE-5E7582D8C9FA\}\\InprocServer32\\\(Default\)|CLSID\\\{7C857801-7381-11CF-884D-00AA004B2E24\}\\InProcServer32\\\(Default\)/ nocase and 
    (
      $event.target.registry.registry_value_data != /system32\\wbem\\wmiutils\.dll/ nocase and
      $event.target.registry.registry_value_data != /system32\\wbem\\wbemsvc\.dll/ nocase
    )
    
  condition:
    $event
}
