rule CVE_2024_3400_GOST_Tunneling_Tools {
  meta:
    author = "Dennis Yap"
    description = "Detects the download of GOST, a Golang tunneling tool, and execute it with two different command-line options to establish SOCKS5 and RTCP tunnels. Hunt for ports 8123 and 8080."
    title = "CVE-2024-3400 GOST Tunneling Tools"
    reference = "https://www.volexity.com/blog/2024/04/12/zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400/"
    sigma_id = "2fc55dab-fde6-4225-88bf-36068556cf06"
    severity = "CRITICAL"
    priority = "CRITICAL"
    mitre_attack_tactic = "Command and Control"
    mitre_attack_technique = "Ingress Tool Transfer"
    version = "1.00"

  events:
    $event.metadata.event_type = "PROCESS_LAUNCH"
    (
        $event.target.process.command_line = /\/vpn_prot\.gz -O \/tmp\/vpn_prot\.gz|\/vpn\.log -O \/tmp\/vpn\.log/ nocase and
        $event.target.process.command_line = /nohup \/tmp\/vpn_prot -L=socks5:\/\/127\.0\.0\.1:8123 > \/dev\/null 2>&1 &/ nocase and
        $event.target.process.command_line = /nohup \/tmp\/vpn_prot -L rtcp:\/\/127\.0\.0\.1:8080\/127\.0\.0\.1:8123/ nocase
    )
    
  condition: 
    $event
}
