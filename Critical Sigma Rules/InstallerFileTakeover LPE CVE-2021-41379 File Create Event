rule InstallerFileTakeover_LPE_CVE_2021_41379_File_Create_Event {
  meta:
    author = "Florian Roth (Nextron Systems)"
    description = "Detects signs of the exploitation of LPE CVE-2021-41379 that include an msiexec process that creates an elevation_service.exe file"
    reference = "https://web.archive.org/web/20220421061949/https://github.com/klinix5/InstallerFileTakeOver, https://www.zerodayinitiative.com/advisories/ZDI-21-1308/"
    sigma_id = "3be82d5d-09fe-4d6a-a275-0d40d234d324"
    severity = "CRITICAL"
    priority = "CRITICAL"
    platform = "Windows"
    mitre_attack_tactic = "Privilege Escalation"
    mitra_attack_technique = "Exploitation for Privilege Escalation"
    version = "1.00"

  events:
    $event.metadata.event_type = "FILE_UNCATEGORIZED"
    (
        $event.target.process.file.full_path = /\\msiexec\.exe$/ nocase and
        $event.target.file.full_path = /^C:\\Program Files \(x86\)\\Microsoft\\Edge\\Application/ nocase and
        $event.target.file.full_path = /\\elevation_service\.exe$/ nocase
    )
    
  condition: 
    $event
}
