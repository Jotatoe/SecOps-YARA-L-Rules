rule FireEye_Malware_Hash_Multiple_Destination {
  meta:
    author = "Jonathan Heng"
    description = "Detects FireEye alerts that indicate possible malware infections on multiple assets"
    severity = "MEDIUM"
    priority = "HIGH"
    platform = "FireEye"
    mitre_attack_tactic = "Execution"
    mitre_attack_technique = "Malicious File"
    version = "1.00"

  events:
    $malware.metadata.vendor_name = "FireEye" nocase
    $malware.metadata.product_event_type = $eventType 
    $eventType = /Malware Hit Found/ nocase

    $malware.target.hostname != ""
    $malware.target.hostname = $targetHost
    
  match:
    $eventType over 24h

  outcome:
    $filePath = array_distinct($malware.about.file.full_path)

  condition:
    #targetHost > 1
}
