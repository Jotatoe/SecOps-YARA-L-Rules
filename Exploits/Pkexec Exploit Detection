rule pkexec_Exploit_Detected {
  meta:
    author = "Jonathan Heng"
    description = "Detects a potential PwnKit/pkexec exploit attempt (CVE-2021-4034) by identifying the execution of pkexec with no command-line arguments."
    severity = "HIGH"
    priority = "HIGH"
    platform = "Linux"
    mitre_attack_technique = "T1068 Exploitation for Privilege Escalation"
    mitre_attack_tactic = "Privilege Escalation"
    version = "1.01"

  events:
    $process.metadata.product_name = "Unix System"
    $process.metadata.event_type = "PROCESS_LAUNCH"
    (
      $process.target.process.file.full_path = /pkexec/ nocase and
      $process.target.process.command_line = /.*\/pkexec$/ nocase
    )
     or
    (
      $process.target.process.file.full_path = /GCONF_PATH/ nocase
    )

  condition:
    $process
}
