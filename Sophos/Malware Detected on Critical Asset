rule Sophos_Malware_Critical_Assets {
  meta:
    author = "Jonathan Heng"
    description = "Detect malware infections when product signature or category indicates malware, and asset is critical"
    severity = "HIGH"
    priority = "HIGH"
    platform = "Sophos"
    mitre_attack_technique = "T1204.002 Malicious File"
    mitre_attack_tactic = "Execution"
    version = "1.00"

  events: 
    $e.metadata.vendor_name = "sophos" nocase
    $e.metadata.description = /Malware detected.*/ nocase
    $e.security_result.category_details = "MALWARE"
    $e.principal.ip = $ip
    $e.principal.ip in %Critical_Hosts 

  condition:
    $e
}
